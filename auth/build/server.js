!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t){e.exports=require("config")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("express-validator")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),s=o(n(6)),a=new i.Schema({name:{type:String,required:!0},email:{type:String,required:!0},password:{type:String,required:!0},avatar:{type:String,required:!0},contactId:{type:String,required:!0},date:{type:Date,default:Date.now},profileSettings:{language:{type:String,default:"en"},socials:{twitter:{type:String,default:"twitter"},facebook:{type:String,default:"facebook",trim:!0},instagram:{type:String,default:"instagram"}}}});a.pre("save",function(e){return r(this,void 0,void 0,function*(){const t=this;t.isModified("password")&&(t.password=yield s.default.hash(t.password,8)),e()})});const u=i.model("user",a);t.default=u},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("bcryptjs")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(2)),i=r(n(0));t.default=function(e,t,n){const r=e.cookies.token;if(!r)return t.status(401).json({msg:"No token, authorization denied"});try{const s=o.default.verify(r,i.default.get("jwtSecret"));e.user=s,n()}catch(e){t.status(401).json({msg:"Token is invalid, authorization denied"})}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(1)),i=r(n(9)),s=r(n(10)),a=r(n(13)),u=r(n(14)),d=o.default(),c=process.env.PORT||5e3;d.use(o.default.urlencoded({extended:!0})),d.use(o.default.json()),d.use(i.default()),d.get("/",(e,t)=>{t.send("AUTH SERVICE ğŸ²ğŸ²")}),d.use("/api/users",s.default),d.use("/api/auth",a.default),u.default(),d.listen(c,()=>{console.log(`listening to port ${c} auth service ğŸ² `)})},function(e,t){e.exports=require("cookie-parser")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s=n(3),a=o(n(11)),u=o(n(2)),d=o(n(4)),c=o(n(0)),l=o(n(7)),f=o(n(12)),p=i.Router();p.post("/",[s.check("name","Name field is required").not().isEmpty(),s.check("email","Please add an email in the correct format").isEmail(),s.check("password","Please enter a password with 6 or more characters").isLength({min:6})],(e,t)=>r(this,void 0,void 0,function*(){const n=s.validationResult(e);if(!n.isEmpty())return t.status(400).json({errors:n.array()});const{name:r,email:o,password:i}=e.body;try{let e=yield d.default.findOne({email:o});if(e)return t.clearCookie("token"),t.status(400).json({errors:[{msg:"Email provided is already in use"}]});const n=a.default.url(o,{s:"200",r:"pg",d:"identicon"}),s=f.default.v4();e=new d.default({name:r,email:o,avatar:n,password:i,contactId:s}),yield e.save();const l={id:e.id},p={expiresIn:36e4};u.default.sign(l,c.default.get("jwtSecret"),p,(e,n)=>{if(e)throw e;t.cookie("token",n,{httpOnly:!0}),t.send(l)})}catch(e){console.error(e.message),t.status(500).send("Server error")}})),p.put("/profile/update",l.default,(e,t)=>r(this,void 0,void 0,function*(){let n=yield d.default.findByIdAndUpdate(e.user.id,{profileSettings:e.body},{new:!0});t.send(n)})),p.get("/me",l.default,(e,t)=>r(this,void 0,void 0,function*(){let n=yield d.default.findById(e.user.id,{name:1,email:1,avatar:1,contactId:1,_id:1});t.send(n)})),p.post("/contact",[l.default,s.check("email","Please add an email in the correct format").isEmail()],(e,t)=>r(this,void 0,void 0,function*(){try{const n=s.validationResult(e);if(!n.isEmpty())return t.status(400).json({errors:n.array()});const r=e.body.email;let o=yield d.default.findOne({email:r},{name:1,email:1,avatar:1,contactId:1,_id:1});if(!o)return t.status(400).json({errors:[{msg:"Contact do not exist"}]});const i={contact:o,userId:e.user.id};t.send(i)}catch(e){console.error(e.message),t.status(500).send("Server error")}})),t.default=p},function(e,t){e.exports=require("gravatar")},function(e,t){e.exports=require("uuid")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s=o(n(6)),a=n(3),u=o(n(4)),d=o(n(2)),c=o(n(0)),l=o(n(7)),f=i.Router();f.post("/",[a.check("email","Please provide a valid email").isEmail(),a.check("password","Password field is required").exists()],(e,t)=>r(this,void 0,void 0,function*(){const n=a.validationResult(e);if(!n.isEmpty())return t.status(400).json({errors:n.array()});const{email:r,password:o}=e.body;try{let e=yield u.default.findOne({email:r});if(!e)return t.clearCookie("token"),t.status(400).json({errors:[{msg:"Invalid Credentials"}]});if(!(yield s.default.compare(o,e.password)))return t.clearCookie("token"),t.status(400).json({errors:[{msg:"Invalid Credentials"}]});const n={id:e.id},i={expiresIn:36e4};d.default.sign(n,c.default.get("jwtSecret"),i,(e,n)=>{if(e)throw e;t.cookie("token",n,{httpOnly:!0}),t.send("cookie sent")})}catch(e){console.error(e.message),t.status(500).send("Server error")}})),f.get("/",l.default,(e,t)=>r(this,void 0,void 0,function*(){try{const n=yield u.default.findById(e.user.id).select("-password");t.json(n)}catch(e){console.error(e.message),t.status(500).send("Server error")}})),f.get("/me/id",l.default,(e,t)=>r(this,void 0,void 0,function*(){try{const n=yield u.default.findById(e.user.id,{_id:1});t.json(n)}catch(e){console.error(e.message),t.status(500).send("Server error")}})),f.delete("/",(e,t)=>r(this,void 0,void 0,function*(){return t.clearCookie("token"),t.status(200).send("cookie removed")})),t.default=f},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),s=o(n(0)),a={useNewUrlParser:!0,useCreateIndex:!0,useFindAndModify:!1};t.default=()=>r(this,void 0,void 0,function*(){try{yield i.connect(s.default.get("mongoURI"),a),console.log("DB auth is connected ğŸ² ")}catch(e){console.error(e.message),process.exit(1)}})}]);